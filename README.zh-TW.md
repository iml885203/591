# 591 ç§Ÿå±‹çˆ¬èŸ²ç³»çµ± ğŸ 

> **æ™ºèƒ½ç§Ÿå±‹ç‰©ä»¶ç›£æ§ç³»çµ±ï¼Œæä¾› 591.com.tw å³æ™‚é€šçŸ¥èˆ‡ç¶²é å„€è¡¨æ¿**

é€™æ˜¯ä¸€å€‹å…¨é¢çš„ Node.js ç¶²é çˆ¬èŸ²ç³»çµ±ï¼Œå°ˆé–€ç›£æ§å°ç£æœ€å¤§çš„ç§Ÿå±‹å¹³å° (591.com.tw) æ–°ä¸Šæ¶ç‰©ä»¶ï¼Œæä¾›å³æ™‚ Discord é€šçŸ¥ï¼Œä¸¦æä¾›ç¶²é ä»‹é¢ç€è¦½ç§Ÿå±‹è³‡æ–™ã€‚å°æ–¼æƒ³è¦ç¬¬ä¸€æ™‚é–“æŒæ¡ç†æƒ³å€åŸŸæ–°æˆ¿æºçš„ç§Ÿå±‹æ—ä¾†èªªï¼Œé€™æ˜¯å®Œç¾çš„è§£æ±ºæ–¹æ¡ˆã€‚

[English README](./README.md) | [API æ–‡ä»¶](http://localhost:3000/swagger) | [ç·šä¸Šå±•ç¤º](https://iml885203.github.io/591/)

---

## ğŸ¯ å°ˆæ¡ˆåŠŸèƒ½èªªæ˜

**å°ç§Ÿå±‹æ—è€Œè¨€ï¼š** å†ä¹Ÿä¸æœƒéŒ¯éå¥½æˆ¿æºã€‚ç•¶ç¬¦åˆæ‚¨æ¢ä»¶çš„æ–°ç‰©ä»¶åœ¨ 591.com.tw ä¸Šæ¶æ™‚ï¼Œç«‹å³æ”¶åˆ°é€šçŸ¥ã€‚

**å°é–‹ç™¼è€…è€Œè¨€ï¼š** ä¸€å€‹ç”Ÿç”¢ç’°å¢ƒå°±ç·’çš„ç¶²é çˆ¬èŸ²ç³»çµ±ï¼Œå…·å‚™ç¾ä»£åŒ–æ¶æ§‹ã€å®Œæ•´æ¸¬è©¦è¦†è“‹ï¼Œä»¥åŠè‡ªå‹•åŒ–éƒ¨ç½²ã€‚

### è§£æ±ºçš„æ ¸å¿ƒå•é¡Œ
- âœ… **éŒ¯éæ–°æˆ¿æº** - å¥½æˆ¿å­ç§Ÿå¾—å¾ˆå¿«ï¼Œæ‚¨éœ€è¦å³æ™‚æé†’
- âœ… **æ‰‹å‹•æª¢æŸ¥** - ä¸éœ€è¦æŒçºŒé‡æ–°æ•´ç† 591.com.tw
- âœ… **é‡è¤‡é€šçŸ¥** - æ™ºèƒ½åµæ¸¬é˜²æ­¢åƒåœ¾è¨Šæ¯
- âœ… **åœ°é»ç¯©é¸** - å°ˆæ³¨æ–¼æ·é‹ç«™é™„è¿‘çš„ç§Ÿå±‹
- âœ… **å¤šæ¢ä»¶æœå°‹** - åŒæ™‚ç›£æ§å¤šå€‹æœå°‹æ¢ä»¶

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```mermaid
graph TB
    subgraph "å¤–éƒ¨æœå‹™"
        A[591.com.tw] --> B[ç¶²é çˆ¬èŸ²]
        B --> C[Discord Webhook]
    end
    
    subgraph "æ ¸å¿ƒç³»çµ±"
        B --> D[REST API ä¼ºæœå™¨]
        D --> E[PostgreSQL è³‡æ–™åº«]
        D --> F[é€šçŸ¥æœå‹™]
        F --> C
    end
    
    subgraph "ä½¿ç”¨ä»‹é¢"
        G[ç¶²é å„€è¡¨æ¿] --> D
        H[ç›´æ¥ API å‘¼å«] --> D
        I[GitHub Actions] --> D
    end
    
    subgraph "å„²å­˜èˆ‡è³‡æ–™"
        E --> J[ç§Ÿå±‹æ¸…å–®]
        E --> K[æœå°‹æŸ¥è©¢] 
        E --> L[æ·é‹è·é›¢è³‡æ–™]
        E --> M[çˆ¬å–æ­·å²]
    end
    
    style B fill:#e1f5fe
    style D fill:#f3e5f5
    style E fill:#e8f5e8
    style G fill:#fff3e0
```

### æ¶æ§‹çµ„ä»¶èªªæ˜

| çµ„ä»¶ | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| **ç¶²é çˆ¬èŸ²** | Cheerio + Axios | å¾ 591.com.tw æå–ç§Ÿå±‹è³‡æ–™ |
| **API ä¼ºæœå™¨** | Express.js + Bun | å¸¶èªè­‰çš„ RESTful API |
| **è³‡æ–™åº«** | PostgreSQL + Prisma | å…·å‚™é·ç§»åŠŸèƒ½çš„æŒä¹…åŒ–å„²å­˜ |
| **é€šçŸ¥ç³»çµ±** | Discord Webhooks | å…·å‚™è±å¯ŒåµŒå…¥å…§å®¹çš„å³æ™‚æé†’ |
| **ç¶²é å„€è¡¨æ¿** | Vue.js + Supabase | ç€è¦½ç§Ÿå±‹è³‡æ–™çš„å‰ç«¯ä»‹é¢ |
| **éƒ¨ç½²ç³»çµ±** | GitHub Actions + Docker | è‡ªå‹•åŒ– CI/CD æµæ°´ç·š |

---

## âœ¨ åŠŸèƒ½ç‰¹è‰²

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½çˆ¬å–** - ç›£æ§ 591.com.tw æ–°ä¸Šæ¶ç§Ÿå±‹ç‰©ä»¶
- **å³æ™‚é€šçŸ¥** - å¸¶æœ‰ç§Ÿå±‹è©³æƒ…å’Œåœ–ç‰‡çš„ Discord æé†’
- **å¤šç«™é»æ”¯æ´** - è™•ç†è·¨å¤šå€‹æ·é‹ç«™çš„æœå°‹
- **é‡è¤‡åµæ¸¬** - é€²éšæ¼”ç®—æ³•é˜²æ­¢é‡è¤‡é€šçŸ¥
- **è·é›¢ç¯©é¸** - å¯è¨­å®šçš„æ·é‹è·é›¢é–€æª»
- **ç¶²é å„€è¡¨æ¿** - é€éç¶²é ä»‹é¢ç€è¦½å’Œæœå°‹ç§Ÿå±‹è³‡æ–™

### ğŸ”§ æŠ€è¡“ç‰¹è‰²
- **ç”Ÿç”¢å°±ç·’** - å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
- **é«˜æ•ˆèƒ½** - å…·å‚™é™æµçš„ä¸¦ç™¼çˆ¬å–
- **ç©©å›ºæ¸¬è©¦** - 105+ å–®å…ƒèˆ‡æ•´åˆæ¸¬è©¦
- **å‹åˆ¥å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æ´èˆ‡ Prisma
- **API æ–‡ä»¶** - è‡ªå‹•ç”¢ç”Ÿçš„ Swagger æ–‡ä»¶
- **è³‡æ–™åº«é·ç§»** - ç‰ˆæœ¬æ§åˆ¶çš„è³‡æ–™çµæ§‹è®Šæ›´
- **Docker æ”¯æ´** - å®¹å™¨åŒ–ç”Ÿç”¢éƒ¨ç½²
- **ç›£æ§åŠŸèƒ½** - å¥åº·æª¢æŸ¥å’ŒåµéŒ¯ç«¯é»

### ğŸŒ å¤šç’°å¢ƒæ”¯æ´
- **æœ¬åœ°é–‹ç™¼** - SQLite/PostgreSQL ç†±é‡è¼‰
- **ç”Ÿç”¢ç’°å¢ƒ** - Supabase é…åˆ RLS æ”¿ç­–
- **æ¸¬è©¦ç’°å¢ƒ** - éš”é›¢æ¸¬è©¦è³‡æ–™åº«èˆ‡æ¨¡æ“¬
- **CI/CD** - è‡ªå‹•åŒ–æ¸¬è©¦èˆ‡éƒ¨ç½²

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç³»çµ±éœ€æ±‚
- **Bun** >= 1.0 (âš ï¸ æœ¬å°ˆæ¡ˆåƒ…ä½¿ç”¨ Bun)
- **PostgreSQL** è³‡æ–™åº« (æœ¬åœ°æˆ– Supabase)
- **Discord webhook** ç”¨æ–¼é€šçŸ¥ (å¯é¸)

### å®‰è£æ­¥é©Ÿ

```bash
# 1. è¤‡è£½å°ˆæ¡ˆ
git clone https://github.com/iml885203/591.git
cd 591

# 2. å®‰è£ç›¸ä¾å¥—ä»¶
bun install

# 3. è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .env æª”æ¡ˆè¨­å®šæ‚¨çš„é…ç½®

# 4. åŸ·è¡Œè³‡æ–™åº«é·ç§»
bun run db:migrate

# 5. å•Ÿå‹• API ä¼ºæœå™¨
bun run api

# 6. æ¸¬è©¦ç³»çµ±
curl -X POST http://localhost:3000/crawl \
  -H "Content-Type: application/json" \
  -H "x-api-key: your-api-key" \
  -d '{"url": "https://rent.591.com.tw/list?region=1&kind=0", "notifyMode": "all"}'
```

### ç’°å¢ƒè®Šæ•¸è¨­å®š

```bash
# è³‡æ–™åº« (å¿…è¦)
DATABASE_URL=postgresql://postgres:password@localhost:5432/crawler

# Discord é€šçŸ¥ (å¯é¸)
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_URL

# API å®‰å…¨æ€§ (å¿…è¦)
API_KEY=your-secret-api-key-here

# å¯é¸è¨­å®š
NOTIFICATION_DELAY=1000
API_PORT=3000
DEBUG_LOGS=false
```

---

## ğŸ“š ä½¿ç”¨æŒ‡å—

### REST API ç«¯é»

```bash
# å¥åº·æª¢æŸ¥
GET /health

# çˆ¬å–ç§Ÿå±‹è³‡æ–™
POST /crawl
{
  "url": "https://rent.591.com.tw/list?region=1&kind=0",
  "notifyMode": "filtered",
  "filter": {"mrtDistanceThreshold": 800}
}

# å¤šç«™é»çˆ¬å–
POST /crawl
{
  "url": "https://rent.591.com.tw/list?region=1&station=4232,4233&kind=0",
  "multiStationOptions": {
    "maxConcurrent": 3,
    "delayBetweenRequests": 1500
  }
}

# å–å¾—æŸ¥è©¢ç§Ÿå±‹è³‡æ–™
GET /query/{queryId}/rentals

# API æ–‡ä»¶
GET /swagger
```

### ç¶²é å„€è¡¨æ¿

åœ¨ [https://iml885203.github.io/591/](https://iml885203.github.io/591/) å­˜å–ç¶²é ä»‹é¢

åŠŸèƒ½åŒ…æ‹¬ï¼š
- ç€è¦½æ‰€æœ‰ç§Ÿå±‹æ¸…å–®
- ä¾åœ°é»ã€åƒ¹æ ¼å’Œæ·é‹è·é›¢ç¯©é¸  
- é€é Supabase å³æ™‚æ›´æ–°
- éŸ¿æ‡‰å¼æ‰‹æ©Ÿç‰ˆè¨­è¨ˆ
- ä½¿ç”¨è€…èªè­‰

---

## ğŸ› ï¸ é–‹ç™¼

### å¯ç”¨æŒ‡ä»¤

```bash
# é–‹ç™¼
bun run api              # å•Ÿå‹• API ä¼ºæœå™¨
bun run build           # ç·¨è­¯ TypeScript
bun run type-check      # åƒ…é€²è¡Œå‹åˆ¥æª¢æŸ¥

# æ¸¬è©¦ (105+ æ¸¬è©¦)
bun run test:unit       # å–®å…ƒæ¸¬è©¦ (æ¨è–¦)
bun test               # æ‰€æœ‰æ¸¬è©¦
bun run test:coverage  # æ¶µè“‹ç‡å ±å‘Š
bun run test:api       # API æ•´åˆæ¸¬è©¦

# è³‡æ–™åº«
bun run db:generate    # ç”¢ç”Ÿ Prisma client
bun run db:migrate     # åŸ·è¡Œé·ç§»
bun run db:studio      # è³‡æ–™åº« UI
bun run db:status      # é·ç§»ç‹€æ…‹
```

### å°ˆæ¡ˆçµæ§‹

```
â”œâ”€â”€ api.js                    # REST API ä¼ºæœå™¨
â”œâ”€â”€ lib/                      # æ ¸å¿ƒæ¨¡çµ„
â”‚   â”œâ”€â”€ crawlService.js      # ä¸»è¦å”èª¿é‚è¼¯
â”‚   â”œâ”€â”€ crawler.js           # ç¶²é çˆ¬å–é‚è¼¯
â”‚   â”œâ”€â”€ multiStationCrawler.js # å¤šç«™é»è™•ç†
â”‚   â”œâ”€â”€ notification.js      # Discord webhooks
â”‚   â”œâ”€â”€ Rental.js           # é ˜åŸŸæ¨¡å‹
â”‚   â””â”€â”€ domain/             # é ˜åŸŸæ¨¡å‹
â”œâ”€â”€ tests/                   # æ¸¬è©¦å¥—ä»¶ (105+ æ¸¬è©¦)
â”‚   â”œâ”€â”€ unit/               # å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ integration/        # æ•´åˆæ¸¬è©¦
â”œâ”€â”€ prisma/                 # è³‡æ–™åº«çµæ§‹èˆ‡é·ç§»
â”œâ”€â”€ samples/                # HTML æ¸¬è©¦ç¯„ä¾‹
â””â”€â”€ scripts/                # å»ºç½®èˆ‡éƒ¨ç½²è…³æœ¬
```

### æŠ€è¡“å †ç–Š

| å±¤ç´š | æŠ€è¡“ | é¸æ“‡åŸå›  |
|------|------|----------|
| **åŸ·è¡Œç’°å¢ƒ** | Bun | å“è¶Šæ•ˆèƒ½èˆ‡ TypeScript æ”¯æ´ |
| **å¾Œç«¯** | Express.js | æˆç†Ÿç”Ÿæ…‹ç³»çµ±èˆ‡è±å¯Œä¸­ä»‹è»Ÿé«” |
| **è³‡æ–™åº«** | PostgreSQL + Prisma | å‹åˆ¥å®‰å…¨æŸ¥è©¢èˆ‡é·ç§»æ”¯æ´ |
| **å‰ç«¯** | Vue.js 3 + Supabase | éŸ¿æ‡‰å¼ UI èˆ‡å³æ™‚è³‡æ–™åŒæ­¥ |
| **æ¸¬è©¦** | Jest | å…¨é¢æ¸¬è©¦èˆ‡é€²éšæ¨¡æ“¬åŠŸèƒ½ |
| **éƒ¨ç½²** | Docker + GitHub Actions | è‡ªå‹•åŒ– CI/CD æµæ°´ç·š |
| **ç›£æ§** | è‡ªå®šç¾©æ—¥èªŒ + å¥åº·æª¢æŸ¥ | ç”Ÿç”¢å°±ç·’çš„å¯è§€æ¸¬æ€§ |

---

## ğŸš€ éƒ¨ç½²

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½² (GitHub Actions)

æœ¬å°ˆæ¡ˆä½¿ç”¨ GitHub Actions è‡ªå‹•éƒ¨ç½²ï¼š

```bash
# 1. æ¨é€åˆ° main åˆ†æ”¯è§¸ç™¼éƒ¨ç½²
git push origin main

# 2. ç›£æ§éƒ¨ç½²ç‹€æ…‹
# æª¢æŸ¥ GitHub Actions: https://github.com/your-repo/actions

# 3. é©—è­‰éƒ¨ç½²
curl https://your-domain.com/health
```

### æ‰‹å‹• Docker éƒ¨ç½²

```bash
# å»ºç½®ä¸¦åŸ·è¡Œç”Ÿç”¢å®¹å™¨
docker-compose -f docker-compose.production.yml up -d

# æª¢æŸ¥æ—¥èªŒ
docker logs crawler-api-prod

# å¥åº·æª¢æŸ¥
curl http://localhost:3001/health
```

### ç”Ÿç”¢ç’°å¢ƒè®Šæ•¸

åœ¨ GitHub repository è¨­å®šä¸­è¨­å®šé€™äº›æ©Ÿå¯†ï¼š

- `DATABASE_URL` - PostgreSQL é€£æ¥å­—ä¸²
- `DISCORD_WEBHOOK_URL` - Discord é€šçŸ¥ webhook
- `API_KEY` - å®‰å…¨çš„ API é‡‘é‘°ç”¨æ–¼èªè­‰
- `MAINTENANCE_WEBHOOK_URL` - éƒ¨ç½²é€šçŸ¥

---

## ğŸ¤ è²¢ç»

1. **Fork** æ­¤å°ˆæ¡ˆ
2. **å»ºç«‹** åŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. **åŸ·è¡Œæ¸¬è©¦** (`bun test`)
4. **æäº¤è®Šæ›´** (`git commit -m 'Add amazing feature'`)
5. **æ¨é€åˆ†æ”¯** (`git push origin feature/amazing-feature`)
6. **é–‹å•Ÿ** Pull Request

### é–‹ç™¼æŒ‡å—

- éµå¾ª TypeScript æœ€ä½³å¯¦è¸
- ç¶­æŒæ¸¬è©¦æ¶µè“‹ç‡è¶…é 85%
- ä½¿ç”¨ conventional commits
- ç‚ºæ–°åŠŸèƒ½æ›´æ–°æ–‡ä»¶
- æäº¤ PR å‰ç¢ºä¿æ‰€æœ‰æ¸¬è©¦é€šé

---

## ğŸ“Š å°ˆæ¡ˆçµ±è¨ˆ

- **105+ æ¸¬è©¦** - å®Œæ•´æ¸¬è©¦æ¶µè“‹ç‡
- **TypeScript** - å®Œæ•´å‹åˆ¥å®‰å…¨
- **ç”Ÿç”¢å°±ç·’** - å¯¦éš›ç”¨æ–¼ç§Ÿå±‹æœå°‹
- **å¤šç’°å¢ƒæ”¯æ´** - æœ¬åœ°ã€æ¸¬è©¦å’Œç”Ÿç”¢ç’°å¢ƒæ”¯æ´
- **è‡ªå‹•åŒ– CI/CD** - GitHub Actions éƒ¨ç½²
- **å³æ™‚æ›´æ–°** - å³æ™‚è³‡æ–™åŒæ­¥

---

## ğŸ“„ æˆæ¬Š

MIT æˆæ¬Š - è©³è¦‹ [LICENSE](LICENSE) æª”æ¡ˆã€‚

---

## ğŸ“‹ ä½¿ç”¨å ´æ™¯

### ç§Ÿå±‹æ—ä½¿ç”¨å ´æ™¯
```
ğŸ  å°ç‹åœ¨å°åŒ—æ‰¾æˆ¿å­
   â†“
ğŸ” è¨­å®šå¤šå€‹æœå°‹æ¢ä»¶ (æ·é‹æ²¿ç·šã€åƒ¹æ ¼ç¯„åœ)
   â†“
âš¡ ç³»çµ± 24/7 ç›£æ§ 591.com.tw
   â†“
ğŸ“± æ–°æˆ¿æºä¸Šæ¶ç«‹å³æ¨é€ Discord é€šçŸ¥
   â†“
ğŸ¯ å¿«é€Ÿè¯ç¹«æˆ¿æ±ï¼Œæ¶å¾—å…ˆæ©Ÿ
```

### æˆ¿ä»²/æŠ•è³‡è€…ä½¿ç”¨å ´æ™¯
```
ğŸ’¼ æˆ¿ä»²æ¥­è€…å¸‚å ´åˆ†æ
   â†“
ğŸ“Š å¤§é‡çˆ¬å–ç§Ÿå±‹è³‡æ–™
   â†“
ğŸ“ˆ åˆ†æå€åŸŸç§Ÿé‡‘è¶¨å‹¢
   â†“
ğŸ¯ åˆ¶å®šæŠ•è³‡ç­–ç•¥
```

---

## ğŸ”— ç›¸é—œé€£çµ

- **ç·šä¸Šå±•ç¤º**: [https://iml885203.github.io/591/](https://iml885203.github.io/591/)
- **API æ–‡ä»¶**: [http://localhost:3000/swagger](http://localhost:3000/swagger) (æœ¬åœ°åŸ·è¡Œæ™‚)
- **GitHub å°ˆæ¡ˆ**: [https://github.com/iml885203/591](https://github.com/iml885203/591)
- **å•é¡Œå›å ±èˆ‡åŠŸèƒ½è«‹æ±‚**: [GitHub Issues](https://github.com/iml885203/591/issues)

---

## ğŸ†˜ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼åªæ”¯æ´ Bunï¼Ÿ
A: Bun æä¾›æ›´å¿«çš„å•Ÿå‹•æ™‚é–“ã€åŸç”Ÿ TypeScript æ”¯æ´ï¼Œä»¥åŠæ›´å¥½çš„æ•ˆèƒ½ã€‚å°ˆæ¡ˆå·²ç¶“å®Œå…¨æ•´åˆ Bun ç”Ÿæ…‹ç³»çµ±ã€‚

### Q: æœƒä¸æœƒè¢« 591.com.tw å°é–ï¼Ÿ
A: ç³»çµ±å…§å»ºè«‹æ±‚é™åˆ¶å’Œéš¨æ©Ÿå»¶é²ï¼Œæ¨¡æ“¬æ­£å¸¸ä½¿ç”¨è€…è¡Œç‚ºã€‚å»ºè­°åˆç†ä½¿ç”¨ï¼Œé¿å…éåº¦é »ç¹çš„è«‹æ±‚ã€‚

### Q: æ”¯æ´å…¶ä»–ç§Ÿå±‹ç¶²ç«™å—ï¼Ÿ
A: ç›®å‰å°ˆæ³¨æ–¼ 591.com.twï¼Œä½†æ¶æ§‹è¨­è¨ˆå…è¨±è¼•é¬†æ“´å±•åˆ°å…¶ä»–ç¶²ç«™ã€‚æ­¡è¿è²¢ç»æ–°çš„çˆ¬èŸ²æ¨¡çµ„ã€‚

### Q: å¦‚ä½•è‡ªå®šç¾©é€šçŸ¥å…§å®¹ï¼Ÿ
A: å¯ä»¥ä¿®æ”¹ `lib/notification.js` ä¸­çš„ Discord embed æ ¼å¼ï¼Œæˆ–è€…é€é API åƒæ•¸è‡ªå®šç¾©ç¯©é¸æ¢ä»¶ã€‚

---

<p align="center">
  <strong>ç”¨ â¤ï¸ ç‚ºå°ç£ç§Ÿå±‹å¸‚å ´æ‰“é€ </strong>
</p>